<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Volunteer Form</title>
<style>
  body {
    font-family: 'Segoe UI', Roboto, Arial, sans-serif;
    background: linear-gradient(135deg, #f0f4ff, #e9f7ef);
    margin: 0;
    padding: 40px;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
  }

  .form-wrapper {
    background: #fff;
    padding: 30px 40px;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    max-width: 600px;
    width: 100%;
  }

  h2 {
    text-align: center;
    margin-bottom: 20px;
    color: #333;
  }

  label {
    display: block;
    margin-top: 15px;
    font-weight: 600;
    color: #444;
  }

  input, select, textarea, button {
    margin-top: 6px;
    padding: 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
    width: 100%;
    font-size: 15px;
    transition: border-color 0.2s ease;
  }

  input:focus, select:focus, textarea:focus {
    border-color: #007BFF;
    outline: none;
    box-shadow: 0 0 0 2px rgba(0,123,255,0.15);
  }

  .name-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
  }

  .position-block {
    border: 1px solid #e0e0e0;
    padding: 20px;
    margin-top: 20px;
    border-radius: 8px;
    background: #fafafa;
  }

  .buttons {
    margin-top: 25px;
    text-align: center;
  }

  button {
    cursor: pointer;
    border: none;
    font-weight: 600;
    padding: 10px 20px;
  }

  .add-btn {
    background-color: #28a745;
    color: white;
    margin-right: 10px;
  }
  .add-btn:hover { background-color: #1e7e34; }

  .submit-btn {
    background-color: #007BFF;
    color: white;
  }
  .submit-btn:hover { background-color: #0056b3; }

  #confirmation {
    margin-top: 20px;
    font-weight: bold;
    color: #28a745;
    text-align: center;
  }

  .error {
    color: #d9534f;
    font-weight: 600;
    margin-top: 15px;
    text-align: center;
  }

  /* Tag styling */
  .tags-container {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    border: 1px solid #ccc;
    padding: 6px;
    border-radius: 6px;
    background: #fff;
    min-height: 40px;
    align-items: center;
  }

  .tag {
    background-color: #007BFF;
    color: white;
    padding: 6px 12px;
    border-radius: 20px;
    display: flex;
    align-items: center;
    font-size: 14px;
  }

  .tag button {
    background: none;
    border: none;
    color: white;
    margin-left: 6px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
  }

  .day-select {
    border: none;
    outline: none;
    font-size: 14px;
    flex: 1;
    min-width: 120px;
  }
</style>
</head>
<body>
<div class="form-wrapper">
  <h2>Volunteer Form</h2>

  <form id="volunteerForm" novalidate>
    <!-- Contact Info -->
    <div class="name-grid">
      <div>
        <label for="firstName">First Name*:</label>
        <input type="text" id="firstName" name="firstName" required>
      </div>
      <div>
        <label for="lastName">Last Name*:</label>
        <input type="text" id="lastName" name="lastName" required>
      </div>
    </div>

    <label for="email">Email*:</label>
    <input
      type="email"
      id="email"
      name="email"
      required
      autocomplete="email"
      inputmode="email"
    >

    <div id="positions">
      <div class="position-block">
        <label>Choose a role*:</label>
        <select name="role" onchange="handleSelection(this)" required>
          <option value="">-- Select an option --</option>
          <option value="food">Food</option>
          <option value="angel">Angel</option>
          <option value="marketplace">Marketplace</option>
        </select>

        <div class="foodDetails hidden">
          <label>Please provide details about the food*:</label>
          <textarea name="foodText" rows="3" placeholder="Enter details here..."></textarea>
        </div>

        <div class="otherDetails hidden">
          <label>Number of individuals volunteering*:</label>
          <input type="number" name="volunteers" min="1" placeholder="Enter a number">

          <label>Choose day(s)*:</label>
          <div class="tags-container" onclick="this.querySelector('select').focus()">
            <select class="day-select" onchange="addTag(this)">
              <option value="">-- Select day --</option>
              <option value="friday">Friday</option>
              <option value="saturday">Saturday</option>
              <option value="sunday">Sunday</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <div class="buttons">
      <button type="button" class="add-btn" onclick="addPosition()">+ Add Another Position</button>
      <button type="submit" class="submit-btn">Submit</button>
    </div>
  </form>

  <div id="error" class="error hidden"></div>
  <div id="confirmation" class="hidden">✅ Thank you! Your response has been recorded.</div>
</div>

<script>
/* --- same JS logic from previous version, no change --- */
function handleSelection(selectElement) {
  const block = selectElement.closest(".position-block");
  const foodDetails = block.querySelector(".foodDetails");
  const otherDetails = block.querySelector(".otherDetails");

  if (selectElement.value === "food") {
    foodDetails.classList.remove("hidden");
    otherDetails.classList.add("hidden");
  } else if (selectElement.value === "angel" || selectElement.value === "marketplace") {
    foodDetails.classList.add("hidden");
    otherDetails.classList.remove("hidden");
  } else {
    foodDetails.classList.add("hidden");
    otherDetails.classList.add("hidden");
  }
}

function addTag(selectElement) {
  const value = selectElement.value;
  if (!value) return;
  const container = selectElement.parentElement;

  if ([...container.querySelectorAll('.tag')].some(tag => tag.dataset.value === value)) {
    selectElement.value = "";
    return;
  }

  const labelMap = { friday: "Friday", saturday: "Saturday", sunday: "Sunday" };

  const tag = document.createElement('span');
  tag.className = 'tag';
  tag.dataset.value = value;
  tag.textContent = labelMap[value] || value;

  const removeBtn = document.createElement('button');
  removeBtn.type = 'button';
  removeBtn.textContent = '×';
  removeBtn.onclick = () => tag.remove();
  tag.appendChild(removeBtn);

  container.insertBefore(tag, selectElement);
  selectElement.value = "";
}

function addPosition() {
  const positionsDiv = document.getElementById("positions");
  const firstBlock = positionsDiv.querySelector(".position-block");
  const newBlock = firstBlock.cloneNode(true);

  newBlock.querySelector("select[name='role']").value = "";
  newBlock.querySelector("textarea[name='foodText']").value = "";
  newBlock.querySelector("input[name='volunteers']").value = "";
  newBlock.querySelector(".foodDetails").classList.add("hidden");
  newBlock.querySelector(".otherDetails").classList.add("hidden");

  const container = newBlock.querySelector(".tags-container");
  container.querySelectorAll('.tag').forEach(t => t.remove());
  container.querySelector('select').value = "";

  positionsDiv.appendChild(newBlock);
}

document.getElementById("volunteerForm").addEventListener("submit", function(event) {
  event.preventDefault();
  const errorDiv = document.getElementById("error");
  errorDiv.classList.add("hidden");
  errorDiv.textContent = "";

  const first = document.getElementById("firstName");
  const last  = document.getElementById("lastName");
  const email = document.getElementById("email");

  if (!first.value.trim() || !last.value.trim() || !email.value.trim()) {
    errorDiv.textContent = "❌ Please fill out First Name, Last Name, and Email.";
    errorDiv.classList.remove("hidden");
    return;
  }

  if (!email.checkValidity()) {
    email.reportValidity();
    errorDiv.textContent = "❌ Please enter a valid email address (example@domain.com).";
    errorDiv.classList.remove("hidden");
    return;
  }

  const blocks = document.querySelectorAll(".position-block");
  const chosenDays = new Set();

  for (let block of blocks) {
    const role = block.querySelector("select[name='role']").value;
    if (!role) {
      errorDiv.textContent = "❌ Please select a role for each position.";
      errorDiv.classList.remove("hidden");
      return;
    }

    if (role === "food") {
      const foodText = block.querySelector("textarea[name='foodText']").value.trim();
      if (!foodText) {
        errorDiv.textContent = "❌ Please provide food details.";
        errorDiv.classList.remove("hidden");
        return;
      }
    }

    if (role === "angel" || role === "marketplace") {
      const num = block.querySelector("input[name='volunteers']").value;
      if (!num || Number(num) < 1) {
        errorDiv.textContent = "❌ Please enter the number of individuals volunteering (1 or more).";
        errorDiv.classList.remove("hidden");
        return;
      }

      const container = block.querySelector(".tags-container");
      const selectedDays = [...container.querySelectorAll('.tag')].map(tag => tag.dataset.value);

      if (selectedDays.length === 0) {
        errorDiv.textContent = "❌ Please select at least one day.";
        errorDiv.classList.remove("hidden");
        return;
      }

      for (let day of selectedDays) {
        if (chosenDays.has(day)) {
          errorDiv.textContent = "❌ Error: The same person cannot sign up for multiple positions on the same night.";
          errorDiv.classList.remove("hidden");
          return;
        }
        chosenDays.add(day);
      }
    }
  }

  document.getElementById("confirmation").classList.remove("hidden");

  document.getElementById("volunteerForm").reset();
  const positionsDiv = document.getElementById("positions");
  const firstBlock = positionsDiv.querySelector(".position-block");
  positionsDiv.innerHTML = "";
  positionsDiv.appendChild(firstBlock);
  firstBlock.querySelectorAll('.tag').forEach(t => t.remove());
  handleSelection(firstBlock.querySelector("select[name='role']"));
});
</script>
</body>
</html>
