<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Volunteer Form</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f1f3f6; }
  h2 { text-align: center; color: #333; }
  
  form { max-width: 700px; margin: auto; background: #fff; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
  
  .form-row { display: flex; gap: 15px; margin-bottom: 15px; }
  .form-group { flex: 1; }
  
  label { display: block; margin-bottom: 6px; font-weight: bold; color: #333; }
  input, select, textarea { width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
  textarea { resize: vertical; }
  
  .position-block { border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 8px; background: #fafafa; position: relative; }
  
  .remove-btn { position: absolute; top: 10px; right: 10px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 28px; height: 28px; cursor: pointer; font-size: 16px; line-height: 28px; text-align: center; }
  .remove-btn:hover { background: #a71d2a; }
  
  button { padding: 10px 18px; border: none; border-radius: 5px; cursor: pointer; font-size: 15px; }
  .add-btn { background-color: #28a745; color: white; margin-top: 10px; }
  .add-btn:hover { background-color: #1e7e34; }
  .submit-btn { background-color: #007BFF; color: white; margin-top: 20px; }
  .submit-btn:hover { background-color: #0056b3; }
  
  .tags-container { display: flex; flex-wrap: wrap; gap: 5px; border: 1px solid #ccc; padding: 5px; border-radius: 4px; min-height: 38px; background: #fff; cursor: text; }
  .tag { background-color: #007BFF; color: white; padding: 4px 8px; border-radius: 4px; display: flex; align-items: center; }
  .tag button { background: none; border: none; color: white; margin-left: 5px; cursor: pointer; font-weight: bold; }
  .day-select { border: none; outline: none; flex: 1; padding: 4px; }
  
  #confirmation { margin-top: 20px; font-weight: bold; color: green; text-align: center; display: none; }
  .error { color: red; font-weight: bold; margin-top: 10px; text-align: center; }
</style>
</head>
<body>
<h2>Volunteer Form</h2>

<form id="volunteerForm">
  <div class="form-row">
    <div class="form-group">
      <label for="firstName">First Name*</label>
      <input type="text" id="firstName" name="firstName" required>
    </div>
    <div class="form-group">
      <label for="lastName">Last Name*</label>
      <input type="text" id="lastName" name="lastName" required>
    </div>
  </div>

  <div class="form-row">
    <div class="form-group" style="flex:1;">
      <label for="email">Email*</label>
      <input type="email" id="email" name="email" required placeholder="example@email.com">
    </div>
  </div>

  <div id="positions">
    <div class="position-block">
      <label>Choose a role*:</label>
      <select name="role" onchange="handleSelection(this)" required>
        <option value="">-- Select an option --</option>
        <option value="food">Food</option>
        <option value="angel">Angel</option>
        <option value="marketplace">Marketplace</option>
      </select>

      <div class="foodDetails hidden">
        <label>Please provide details about the food:</label>
        <textarea name="foodText" rows="3" placeholder="Enter details here..."></textarea>
      </div>

      <div class="otherDetails hidden">
        <label>Number of individuals volunteering*:</label>
        <input type="number" name="volunteers" min="1" required placeholder="Enter a number">

        <label>Choose day(s)*:</label>
        <div class="tags-container" onclick="this.querySelector('select').focus()">
          <select class="day-select" onchange="addTag(this)">
            <option value="">-- Select day --</option>
            <option value="friday">Friday</option>
            <option value="saturday">Saturday</option>
            <option value="sunday">Sunday</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <button type="button" class="add-btn" onclick="addPosition()">+ Add Another Role</button><br>
  <button type="submit" class="submit-btn">Submit</button>
</form>

<div id="error" class="error hidden"></div>
<div id="confirmation">✅ Thank you! Your response has been recorded.</div>

<script>
function handleSelection(selectElement) {
  const block = selectElement.closest(".position-block");
  const foodDetails = block.querySelector(".foodDetails");
  const otherDetails = block.querySelector(".otherDetails");

  if (selectElement.value === "food") {
    foodDetails.classList.remove("hidden");
    otherDetails.classList.add("hidden");
  } else if (selectElement.value === "angel" || selectElement.value === "marketplace") {
    foodDetails.classList.add("hidden");
    otherDetails.classList.remove("hidden");
  } else {
    foodDetails.classList.add("hidden");
    otherDetails.classList.add("hidden");
  }
}

// Tag logic
function addTag(selectElement) {
  const value = selectElement.value;
  if (!value) return;
  const container = selectElement.parentElement;

  if ([...container.querySelectorAll('.tag')].some(tag => tag.dataset.value === value)) {
    selectElement.value = "";
    return;
  }

  const tag = document.createElement('span');
  tag.className = 'tag';
  tag.dataset.value = value;
  tag.textContent = value;

  const removeBtn = document.createElement('button');
  removeBtn.type = 'button';
  removeBtn.textContent = '×';
  removeBtn.onclick = () => tag.remove();
  tag.appendChild(removeBtn);

  container.insertBefore(tag, selectElement);
  selectElement.value = "";
}

// Clone position block
function addPosition() {
  const positionsDiv = document.getElementById("positions");
  const firstBlock = positionsDiv.querySelector(".position-block");
  const newBlock = firstBlock.cloneNode(true);

  newBlock.querySelector("select[name='role']").value = "";
  newBlock.querySelector("textarea[name='foodText']").value = "";
  newBlock.querySelector("input[name='volunteers']").value = "";
  newBlock.querySelector(".foodDetails").classList.add("hidden");
  newBlock.querySelector(".otherDetails").classList.add("hidden");
  newBlock.querySelectorAll('.tag').forEach(t => t.remove());
  newBlock.querySelector('.day-select').value = "";

  // Add remove button for additional roles
  const removeBtn = document.createElement("button");
  removeBtn.type = "button";
  removeBtn.className = "remove-btn";
  removeBtn.textContent = "×";
  removeBtn.onclick = () => newBlock.remove();
  newBlock.appendChild(removeBtn);

  positionsDiv.appendChild(newBlock);
}

// Form submission
document.getElementById("volunteerForm").addEventListener("submit", function(event) {
  event.preventDefault();
  const errorDiv = document.getElementById("error");
  const confirmation = document.getElementById("confirmation");
  
  errorDiv.classList.add("hidden");
  errorDiv.textContent = "";
  confirmation.style.display = "none";

  // Email validation
  const email = document.getElementById("email").value;
  const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailPattern.test(email)) {
    errorDiv.textContent = "❌ Please enter a valid email address.";
    errorDiv.classList.remove("hidden");
    return;
  }

  const blocks = document.querySelectorAll(".position-block");
  const chosenDays = new Set();

  for (let block of blocks) {
    const role = block.querySelector("select[name='role']").value;
    if (role === "angel" || role === "marketplace") {
      const container = block.querySelector(".tags-container");
      const selectedDays = [...container.querySelectorAll('.tag')].map(tag => tag.dataset.value);

      for (let day of selectedDays) {
        if (chosenDays.has(day)) {
          errorDiv.textContent = "❌ The same person cannot sign up for multiple positions on the same night.";
          errorDiv.classList.remove("hidden");
          return;
        }
        chosenDays.add(day);
      }
    }
  }

  confirmation.style.display = "block";

  // Reset form (keep one empty block)
  const positionsDiv = document.getElementById("positions");
  const firstBlock = positionsDiv.querySelector(".position-block");
  positionsDiv.innerHTML = "";
  positionsDiv.appendChild(firstBlock);

  firstBlock.querySelector("select[name='role']").value = "";
  firstBlock.querySelector("textarea[name='foodText']").value = "";
  firstBlock.querySelector("input[name='volunteers']").value = "";
  firstBlock.querySelector(".foodDetails").classList.add("hidden");
  firstBlock.querySelector(".otherDetails").classList.add("hidden");
  firstBlock.querySelectorAll('.tag').forEach(t => t.remove());
  firstBlock.querySelector('.day-select').value = "";

  document.getElementById("volunteerForm").reset();
  handleSelection(firstBlock.querySelector("select[name='role']"));
});
</script>
</body>
</html>
